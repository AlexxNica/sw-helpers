{"version":3,"sources":["index.js"],"names":["global","factory","exports","module","define","amd","goog","cacheExpiration","idb","fn","toArray","arr","Array","prototype","slice","call","promisifyRequest","request","Promise","resolve","reject","onsuccess","result","onerror","error","promisifyRequestCall","obj","method","args","p","apply","then","promisifyCursorRequestCall","value","Cursor","proxyProperties","ProxyClass","targetProp","properties","forEach","prop","Object","defineProperty","get","proxyRequestMethods","Constructor","arguments","proxyMethods","proxyCursorRequestMethods","Index","index","_index","cursor","_cursor","_request","ObjectStore","store","_store","Transaction","idbTransaction","_tx","complete","oncomplete","UpgradeDB","db","oldVersion","transaction","_db","DB","IDBIndex","IDBCursor","methodName","createIndex","IDBObjectStore","objectStore","IDBTransaction","createObjectStore","IDBDatabase","funcName","replace","callback","length","nativeObject","getAll","query","count","instance","items","iterateCursor","push","continue","exp","open","name","version","upgradeCallback","indexedDB","onupgradeneeded","event","delete","self","assert","atLeastOne","object","parameters","keys","some","parameter","Error","map","join","hasMethod","expectedMethod","pop","type","isInstance","expectedClass","isOneOf","values","includes","isType","expectedType","actualType","Configuration","constructor","cacheName","maxEntries","maxAgeSeconds","idbName","registration","scope","Behavior","configuration","upgradeDB","updateTimestamp","url","now","Date","tx","put","expireEntries","promises","_expireOldEntries","_expireExtraEntries","all","oldEntries","extraEntries","concat","expireOlderThan","urls","key"],"mappings":"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","file":"cache-expiration.umd.min.js","sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n\ttypeof define === 'function' && define.amd ? define(['exports'], factory) :\n\t(factory((global.goog = global.goog || {}, global.goog.cacheExpiration = global.goog.cacheExpiration || {})));\n}(this, (function (exports) { 'use strict';\n\nfunction createCommonjsModule(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\nvar idb = createCommonjsModule(function (module) {\n'use strict';\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n  \n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      request.onupgradeneeded = function(event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    module.exports = exp;\n  }\n  else {\n    self.idb = exp;\n  }\n}());\n});\n\n/*\n Copyright 2016 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\nfunction atLeastOne(object) {\n  const parameters = Object.keys(object);\n  if (!parameters.some(parameter => object[parameter] !== undefined)) {\n    throw Error('Please set at least one of the following parameters: ' +\n      parameters.map(p => `'${p}'`).join(', '));\n  }\n}\n\nfunction hasMethod(object, expectedMethod) {\n  const parameter = Object.keys(object).pop();\n  const type = typeof object[parameter][expectedMethod];\n  if (type !== 'function') {\n    throw Error(`The '${parameter}' parameter must be an object that exposes a '${expectedMethod}' method.`);\n  }\n}\n\nfunction isInstance(object, expectedClass) {\n  const parameter = Object.keys(object).pop();\n  if (!(object[parameter] instanceof expectedClass)) {\n    throw Error(`The '${parameter}' parameter must be an instance of '${expectedClass.name}'`);\n  }\n}\n\nfunction isOneOf(object, values) {\n  const parameter = Object.keys(object).pop();\n  if (!values.includes(object[parameter])) {\n    throw Error(`The '${parameter}' parameter must be set to one of the following: ${values}`);\n  }\n}\n\nfunction isType(object, expectedType) {\n  const parameter = Object.keys(object).pop();\n  const actualType = typeof object[parameter];\n  if (actualType!== expectedType) {\n    throw Error(`The '${parameter}' parameter has the wrong type. (Expected: ${expectedType}, actual: ${actualType})`);\n  }\n}\n\nvar assert = {\n  atLeastOne,\n  hasMethod,\n  isInstance,\n  isOneOf,\n  isType\n};\n\n/*\n Copyright 2016 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\n/**\n * Placeholder.\n */\nclass Configuration {\n  /**\n   * Placeholder.\n   *\n   * @param {string} cacheName\n   * @param {Number} maxEntries\n   * @param {Number} maxAgeSeconds\n   */\n  constructor({cacheName, maxEntries, maxAgeSeconds} = {}) {\n    assert.isType({cacheName}, 'string');\n    assert.atLeastOne({maxEntries, maxAgeSeconds});\n\n    this.cacheName = cacheName;\n    this.maxEntries = maxEntries;\n    this.maxAgeSeconds = maxAgeSeconds;\n  }\n}\n\n/*\n Copyright 2016 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\nconst idbName = `sw-cache-expiration-${self.registration.scope}`;\nconst idbVersion = 1;\n\n/*\n Copyright 2016 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\n/**\n * TODO Behavior Description\n * @memberof module:sw-cache-expiration\n */\nclass Behavior {\n  /**\n   * @param {Object} input\n   * @param {Object} input.configuration\n   */\n  constructor({configuration}) {\n    if (typeof configuration === 'undefined') {\n      configuration = {};\n    }\n\n    assert.isInstance({configuration}, Configuration);\n    this.configuration = configuration;\n  }\n\n  /**\n   * Get the cache name\n   * @memberof module:sw-cache-expiration.Behavior\n   * @member {String} cacheName\n   */\n  get cacheName() {\n    return this.configuration.cacheName;\n  }\n\n  /**\n   * Get the max cache entries.\n   * @return {Number} Returns the number of max entries\n   */\n  get maxEntries() {\n    return this.configuration.maxEntries;\n  }\n\n  /**\n   * Get the max age for the cache entries.\n   * @return {Number} Max age in seconds for cache entries.\n   */\n  get maxAgeSeconds() {\n    return this.configuration.maxAgeSeconds;\n  }\n\n  /**\n   * @private\n   * @return {idb} Get open idb.\n   */\n  get db() {\n    if (!this._db) {\n      return idb.open(idbName, idbVersion, (upgradeDB) => {\n        upgradeDB.createObjectStore(this.cacheName);\n      }).then((db) => {\n        this._db = db;\n      });\n    }\n\n    return Promise.resolve(this._db);\n  }\n\n  /**\n   * TODO updateTimestamp description\n   * @private\n   * @param {string} url\n   * @param {Number} now Defaults to current date.\n   * @return {Promise} Resolves once updated.\n   */\n  updateTimestamp(url, now) {\n    if (typeof now === 'undefined') {\n      now = Date.now();\n    }\n\n    return this.db.then((db) => {\n      const tx = db.transaction(this.cacheName, 'readwrite');\n      tx.objectStore(this.cacheName).put(now, url);\n      return tx.complete;\n    });\n  }\n\n  /**\n   * TODO expireEntries description\n   * @param {Number} now Defaults to the current time\n   * @return {Promise} List of removed entries.\n   */\n  expireEntries(now) {\n    if (typeof now === 'undefined') {\n      now = Date.now();\n    }\n\n    const promises = [];\n    promises.push(\n      this.maxAgeSeconds ? this._expireOldEntries(now) : Promise.resolve([]));\n    promises.push(\n      this.maxEntries ? this._expireExtraEntries() : Promise.resolve([]));\n\n    return Promise.all(promises)\n      .then(([oldEntries, extraEntries]) => oldEntries.concat(extraEntries));\n  }\n\n  /**\n   * @private\n   * @param {Number} now\n   * @return {Promise<Array<String>>} Promise that resolves to an\n   *         array of urls.\n   */\n  _expireOldEntries(now) {\n    if (typeof now === 'undefined') {\n      now = Date.now();\n    }\n\n    const expireOlderThan = now - (this.maxAgeSeconds * 1000);\n    const urls = [];\n    return this.db.then((db) => {\n      const tx = db.transaction(this.cacheName, 'readwrite');\n      const store = tx.objectStore(this.cacheName);\n      store.iterateCursor((cursor) => {\n        if (!cursor) {\n          return;\n        }\n        if (cursor.value < expireOlderThan) {\n          urls.push(cursor.key);\n          store.delete(cursor.key);\n        }\n        cursor.continue();\n      });\n      return tx.complete.then(() => urls);\n    });\n  }\n\n  /**\n   * @private\n   * @return {Promise} Resolve to empty array.\n   */\n  _expireExtraEntries() {\n    return Promise.resolve([]);\n  }\n}\n\n/*\n Copyright 2016 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\n/**\n * sw-cache-expiration Module\n * @module sw-cache-expiration\n */\n\nexports.Behavior = Behavior;\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n})));\n"],"sourceRoot":"/source/"}